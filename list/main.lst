C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\obj\main.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE src\main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\list\main.lst) TABS(2) OBJECT(
                    -.\obj\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          
   4          #include " LCD12864.h " //ÀïÃæ¶¨ÒåÁË12864Òº¾§µÄ¶Ë¿Ú½Ó·¨  ÒÔ¼° 12864³ÌĞòÉùÃû
   5          #include "Finger_Modle.h"//Ö¸ÎÆÄ£¿éµÄÍ·ÎÄ¼ş
   6          
   7          //=====P3µÄ¸ß4Î»½ÓÁË°´¼ü£¬¿ÉÒÔÔÚkeyscanÀïÃæ¸Ä=============
   8          sfr KEY=0xB0; //¾ÍÊÇP3,²Î¿¼reg52.h
   9          #define G_upkey 0x80 //px.7 °´¼ü£¬ÏòÉÏ¼ü
  10          #define G_downkey 0x40 //px.6 °´¼ü£¬ÏòÏÂ¼ü
  11          #define G_entkey 0x20 //px.5 °´¼ü£¬È·¶¨¼ü
  12          #define G_cankey 0x10//px.4 °´¼ü£¬È¡Ïû¼ü
  13          //===========°´¼ü======================================
  14          
  15          sbit relay =P1^4; //¼ÌµçÆ÷Òı½Å
  16          sbit buzzer=P1^5; //·äÃùÆ÷Òı½Å
  17          sbit red=   P2^7;//Â¼ÈëÄ£Ê½Ö¸Ê¾µÆ ÔÚ°å×Ó¿¿½üµ¥Æ¬»ú´¦
  18          sbit green= P2^0;//Ê¶±ğÄ£Ê½Ö¸Ê¾µÆ ÔÚ°å×ÓÔ¶Àëµ¥Æ¬»ú´¦
  19          
  20          void delayms(int ms);
  21          void keyscan();//°´¼üÉ¨Ãè
  22          
  23          unsigned char Trg;//°´¼ü´¥·¢£¬Ò»×ép3ÀïÃæÖ»»á³öÏÖÒ»´Î
  24          unsigned char Cont;//°´¼ü³¤°´£¬±»keyscanº¯Êı¸Ä±ä
  25          
  26          unsigned char KeyFuncIndex=0;    //´æ·Åµ±Ç°µÄ²Ëµ¥Ë÷Òı
  27          
  28          void (*KeyFuncPtr)();            //¶¨Òå°´¼ü¹¦ÄÜÖ¸Õë
  29          //¶¨ÒåÀàĞÍ 
  30          typedef struct 
  31          {
  32             unsigned char KeyStateIndex;   //µ±Ç°µÄ×´Ì¬Ë÷ÒıºÅ
  33             unsigned char KeyUpState;      //°´ÏÂÏòÉÏ¼üÊ±µÄ×´Ì¬Ë÷ÒıºÅ
  34             unsigned char KeyDownState;    //°´ÏÂÏòÏÂ¼üÊ±µÄ×´Ì¬Ë÷ÒıºÅ
  35             unsigned char KeyEnterState;   //°´ÏÂ»Ø³µ¼üÊ±µÄ×´Ì¬Ë÷ÒıºÅ
  36             unsigned char KeyCancle;       //°´ÏÂÈ¡ÏûÍË»ØÉÏ¼¶²Ëµ¥
  37             void (*CurrentOperate)(void);      //µ±Ç°×´Ì¬Ó¦¸ÃÖ´ĞĞµÄ¹¦ÄÜ²Ù×÷
  38          }  StateTab;
  39          
  40          //===========================================================================
  41          //================ÏÂÃæÊÇ¸÷²Ëµ¥²ãµÄÊµÊ©º¯Êı================================
  42          //============================================================================
  43          
  44          void Stat00(void){//µÚÒ»¸öÒ³ÃæÏÔÊ¾ÊÇ·ñÎÕÊÖ³É¹¦£¬³É¹¦µÄ»°°´ÈÎÒâ¼ü½øÈëÏÂÒ»¸öÒ³Ãæ£¬²»³É¹¦µÄ»°¾Í²»¿ª¶¨Ê±¼üÅÌÉ¨
             -ÃèÖĞ¶Ï
  45   1        unsigned char i;
  46   1        ET0=0;//ÏÈ¹Øµô¶¨Ê±Æ÷ÖĞ¶Ï£¬±ÜÃâÔÚ´¦ÀíÊ±ÏìÓ¦ÁË¼üÅÌ£¬½øÈëÁËÏÂÒ»¸ö×´Ì¬£¬¶øÕâÕâ×´Ì¬»¹Ã»ÔËĞĞÍê
  47   1        dprintf(0,0,"  ÄÏÄÁÖ¸ÎÆ¿ª¹Ø  ");
  48   1        for(i=0;i<6;i++)//¿ªÊ¼ÎÕÊÖ6´Î£¬Èç¹ûÃ»ÓĞÒ»´Î³É¹¦£¬±íÊ¾Ä£¿éÍ¨ĞÅ²»Õı³£¡£Ö»Òª³É¹¦¾ÍÌø³ö´ËÑ­»·
  49   1        {
  50   2          if(FM_VefPSW())//ÓëÄ£¿éÎÕÊÖÍ¨¹ı£¬ÂÌµÆÁÁÆğ¡£½øÈëÊ¶±ğÄ£Ê½
  51   2          {
  52   3            dprintf(1,0,"    ÎÕÊÖ³É¹¦    ");
  53   3            dprintf(3,0,"°´ÈÎÒâ¼ü½øÈëÏµÍ³");
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 2   

  54   3            //ET0=1;//³É¹¦µÄ»°¿ª¶¨Ê±¼üÅÌÉ¨ÃèÖĞ¶Ï£¬¿ÉÒÔ½øÈëÏÂÒ»¸ö×´Ì¬£¬·ñÔòµÄ»°¾ÍÒ»Ö±ÏÔÊ¾ÏÂÃæµÄÊ§°Ü½çÃæ
  55   3            break;//ÍË³öÈ«²¿Ñ­»·£¬Ö´ĞĞÏÂÃæforµÄÓï¾ä£¬²»Í¬Óëcontinue
  56   3          }
  57   2            else
  58   2          {
  59   3            dprintf(1,0,"    ÎÕÊÖÊ§°Ü    ");//Èç¹ûÊ§°Ü¼ÌĞøÖ´ĞĞÏÂÒ»´Îfor¿´»á²»»á³É¹¦
  60   3            dprintf(3,0,"Çë¼ì²éÏßÂ·Ä£¿é");
  61   3            //break;
  62   3          }
  63   2        }
  64   1        ET0=1;
  65   1      }
  66          void Stat10(void){ //ui´ò¿ª¿ª¹Ø
  67   1        ET0=0;//¹Ø¶¨Ê±Æ÷ÖĞ¶Ï±ÜÃâÏìÓ¦°´¼ü£¬¼ÇµÃ¿ª»ØÀ´
  68   1        dprintf(0,0,"    ¿ª¹Ø»úÆ÷   ");//·´°×ÏÔÊ¾
  69   1        dprintf(1,0,"    Â¼ÈëÖ¸ÎÆ    ");
  70   1        dprintf(2,0,"    Çå¿ÕÖ¸ÎÆ    ");
  71   1        dprintf(3,0,"                ");
  72   1        Writecolor_hang_12864(0,1);//·´°×µÚÒ»ĞĞ£¬0´ú±íµÚÒ»ĞĞ£¬1´ú±íºÚÉ«
  73   1        Writecolor_hang_12864(1,0);
  74   1        ET0=1;
  75   1      }
  76          void Stat11(void){ //uiÂ¼ÈëÖ¸ÎÆ
  77   1        ET0=0;
  78   1        dprintf(0,0,"    ¿ª¹Ø»úÆ÷    ");//·´°×ÏÔÊ¾
  79   1        dprintf(1,0,"    Â¼ÈëÖ¸ÎÆ    ");
  80   1        dprintf(2,0,"    Çå¿ÕÖ¸ÎÆ    ");
  81   1        dprintf(3,0,"                ");
  82   1        Writecolor_hang_12864(0,0);//°ÑÉÏÒ»ĞĞµÄÌî³ä²ìµô
  83   1        Writecolor_hang_12864(2,0);//È·±£ÖØÏÂÍùÉÏ°´Ê±ÏÂÃæÄÇĞĞ²Áµô
  84   1        Writecolor_hang_12864(1,1);//·´°×µÚ¶şĞĞ
  85   1        ET0=1;
  86   1      }
  87          void Stat12(void){ //uiÇå¿ÕÖ¸ÎÆ
  88   1        ET0=0;
  89   1        dprintf(0,0,"    ¿ª¹Ø»úÆ÷    ");//·´°×ÏÔÊ¾
  90   1        dprintf(1,0,"    Â¼ÈëÖ¸ÎÆ    ");
  91   1        dprintf(2,0,"    Çå¿ÕÖ¸ÎÆ    ");
  92   1        dprintf(3,0,"                ");
  93   1        Writecolor_hang_12864(1,0);
  94   1        Writecolor_hang_12864(3,0);
  95   1        Writecolor_hang_12864(2,1);
  96   1        ET0=1;
  97   1      }
  98          /*
  99          void Stat13(void){ 
 100            ET0=0;
 101            dprintf(0,0,"    ´ò¿ª¿ª¹Ø    ");//·´°×ÏÔÊ¾
 102            dprintf(1,0,"    Â¼ÈëÖ¸ÎÆ    ");
 103            dprintf(2,0,"    Çå¿ÕÖ¸ÎÆ    ");
 104            dprintf(3,0,"    ´ò¿ªµçÔ´    ");
 105            Writecolor_hang_12864(2,0);
 106            Writecolor_hang_12864(3,1);
 107            ET0=1;
 108          }*/
 109          
 110          void Stat20(void){//´ò¿ª¿ª¹Ø--È·¶¨
 111   1        unsigned char num=0;
 112   1        unsigned char strnum[4]={0};//ÊıÁ¿×ª»»Îª×Ö·û´®
 113   1        ET0=0;
 114   1        LcmClearTXT();//Çå³ıÎÄ±¾
 115   1        LcmClearBMP();//Çå³ıÍ¼Ïñ
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 3   

 116   1        if(relay==0){//Èç¹û¼ÌµçÆ÷ÊÇ¿ªÆôµÄ
 117   2          dprintf(0,0,"¿ª¹ØÒÑ¾­¿ªÆô    ");//keil bugÓÃÄÚÂë
 118   2          dprintf(1,0,"ÊäÈëÖ¸ÎÆ¹Ø±Õ    ");
 119   2          dprintf(2,0,"                ");
 120   2          dprintf(3,0,"µÈ\xB4\xFDÊäÈë........");
 121   2        }else{
 122   2          dprintf(0,0,"¿ª¹ØÒÑ¾­¹Ø±Õ    ");//keil bugÓÃÄÚÂë
 123   2          dprintf(1,0,"ÊäÈëÖ¸ÎÆ¿ªÆô    ");
 124   2          dprintf(2,0,"                ");
 125   2          dprintf(3,0,"µÈ\xB4\xFDÊäÈë........");
 126   2        }
 127   1        num=FM_Search();
 128   1        strnum[0]=32;//acsiiÂë¿Õ¸ñ
 129   1        strnum[1]= num/100+48;     //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  °Ù
 130   1        strnum[2]= (num%100)/10+48;//+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  Ê®
 131   1        strnum[3]= num%10+48;      //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  ¸ö?
 132   1        if(num==0xff){//²Ù×÷Ê§°Ü
 133   2          dprintf(0,0,"¸ÃÖ¸ÎÆ²»´æÔÚ    ");//keil bugÓÃÄÚÂë
 134   2          dprintf(1,0,"²Ù×÷Ê§°Ü        ");
 135   2          dprintf(2,0,"                ");
 136   2          dprintf(3,0,"°´ÈÎÒâ¼ü·µ»Ø    ");
 137   2          buzzer=0;
 138   2          delayms(500);
 139   2          buzzer=1;
 140   2        }else{//¸ÃÖ¸ÎÆ´æÔÚ²Ù×÷³É¹¦
 141   2          dprintf(0,0,"²Ù×÷³É¹¦        ");
 142   2          dprintf(1,0,"                ");
 143   2          dprintf(2,0,"ÓÃ»§ºÅ: ");
 144   2          dprintf(2,4,strnum);
 145   2          dprintf(2,6,"   ");
 146   2          dprintf(3,0,"°´ÈÎÒâ¼ü·µ»Ø    ");
 147   2          relay=~relay;//¼ÌµçÆ÷·­×ª
 148   2          buzzer=0;
 149   2          delayms(500);
 150   2          buzzer=1;
 151   2        }
 152   1        ET0=1;
 153   1      }
 154          
 155          void Stat21(void){//Â¼ÈëÖ¸ÎÆ--È·¶
 156   1       
 157   1        unsigned char strnum[4]={0};//ÊıÁ¿×ª»»Îª×Ö·û´®
 158   1        unsigned char FM_model_num=0,search_num=0;//Ä£¿éÀïÃæµÄÖ¸ÎÆ´æ´¢ÊıÁ¿
 159   1        bit ok1=0,ok2=0;
 160   1        ET0=0;//¹Ø°´¼üÉ¨Ãè
 161   1        LcmClearTXT();//Çå³ıÎÄ±¾
 162   1        LcmClearBMP();//Çå³ıÍ¼Ïñ
 163   1        FM_model_num=FM_ValidTempleteNum(0);//¶ÁÈ¡Ö¸ÎÆÄ£¿éÀïÃæµÄÄ£°æÊıÁ¿µÍÎ»£¬µÍÎ»¾Í¹»?
 164   1      
 165   1        
 166   1        if((FM_model_num==0xff)){//Èç¹û¶ÁÄ£°æÊıÖ¸Áî·µ»Ø´íÎóÖµ
 167   2          dprintf(0,0,"¶ÁÈ¡Ä£°æ\xCA\xFD´íÎó  ");//keil bugÓÃÄÚÂë
 168   2          dprintf(1,0,"                ");
 169   2          dprintf(2,0,"                ");
 170   2          dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 171   2          goto end;//Ìø¹ıÁË¶ÁÈ¡Ö¸ÎÆ
 172   2        }else{//Èç¹ûÊÇÕı³£¶ÁÈ¡Ä£°æÊı
 173   2          if((FM_model_num==0)||(FM_model_num==1)){//ÄãÊÇµÚÒ»¸ö£¬µÚ2¸öÊäÈëÖ¸ÎÆµÄ£¬¾ßÓĞ×î¸ßÈ¨ÏŞ
 174   3            dprintf(0,0,"    ×î¸ßÈ¨ÏŞ    ");
 175   3            goto begin;
 176   3          }else{//ÄãÊÇµÚÈı¸ö»òÆäËûÊäÈëµÄÈË£¬ÄãµÄÂ¼ÈëÊÇ²»Í¬µÄ£¬£¬ÄãµÄÊäÈëĞèÒª×î¸ßÈ¨ÏŞµÄÍ¬Òâ£¬ÄãÖ»ÓĞÆÕÍ¨È¨ÏŞ
 177   3            dprintf(0,0,"    ÓÃ»§È¨ÏŞ    ");
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 4   

 178   3            dprintf(1,0,"Çë¹ÜÀíÔ±ÊäÈëÖ¸ÎÆ");
 179   3            dprintf(2,0,"µÈ\xB4\xFDÊäÈë........");
 180   3            search_num=FM_Search();
 181   3            if((search_num==1)||(search_num==2)){//Èç¹ûÊÇµÚ 1£¬2ºÅÖ¸ÎÆ¾ÍÊÇ¹ÜÀíÔ±£¬¾ßÓĞÈ¨ÏŞÔËĞĞÏÂÃæµÄÂ¼ÈëÖ¸ÎÆ
 182   4              strnum[0]=32;//acsiiÂë¿Õ¸ñ
 183   4              strnum[1]= search_num/100+48;     //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  °Ù
 184   4              strnum[2]= (search_num%100)/10+48;//+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  Ê®
 185   4              strnum[3]= search_num%10+48;      //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  ¸ö?
 186   4              dprintf(1,0,"ÑéÖ¤³É¹¦        ");
 187   4              dprintf(2,0,"¹ÜÀíÔ±: ");
 188   4              dprintf(2,4,strnum);
 189   4              dprintf(2,6,"   ");
 190   4              buzzer=0;
 191   4              delayms(500);//·äÃù
 192   4              buzzer=1;
 193   4              goto begin;
 194   4            }else if(search_num==0xff){//²»ÄÜËÑË÷µ½¸ÃÖ¸ÎÆ
 195   4              dprintf(0,0,"    ÓÃ»§È¨ÏŞ    ");
 196   4              dprintf(1,0,"¸ÃÖ¸ÎÆ»¹Ã»Â¼Èë  ");
 197   4              dprintf(2,0,"                ");
 198   4              dprintf(3,0,"°´ÈÎÒâ¼üÍË»ØÖØÊÔ");
 199   4              buzzer=0;
 200   4              delayms(500);//·äÃù
 201   4              buzzer=1;
 202   4              goto end;
 203   4            }else{//Ö¸ÎÆÊÇÂ¼ÈëµÄµ«²»ÊÇ1£¬2ºÅÖ¸ÎÆ£¬Ã»ÓĞ×î¸ßÈ¨ÏŞ
 204   4              strnum[0]=32;//acsiiÂë¿Õ¸ñ
 205   4              strnum[1]= search_num/100+48;     //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  °Ù
 206   4              strnum[2]= (search_num%100)/10+48;//+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  Ê®
 207   4              strnum[3]= search_num%10+48;      //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  ¸ö?
 208   4              dprintf(1,0,"ÄãµÄÈ¨ÏŞ²»×ã    ");
 209   4              dprintf(2,0,"ÓÃ»§ºÅ: ");
 210   4              dprintf(2,4,strnum);
 211   4              dprintf(2,6,"   ");
 212   4              dprintf(3,0,"°´ÈÎÒâ¼üÍË»ØÖØÊÔ");
 213   4              buzzer=0;
 214   4              delayms(500);//·äÃù
 215   4              buzzer=1;
 216   4              goto end;
 217   4            }
 218   3          }
 219   2        }
 220   1            //--------------------¶ÁÈ¡Á½´ÎÖ¸ÎÆ±£´æµ½Ä£°æ---------------------------------
 221   1            begin:
 222   1          //Êı×Ö×ªÎªcharÀàĞÍÏÔÊ¾
 223   1            strnum[0]=32;//acsiiÂë¿Õ¸ñ
 224   1            strnum[1]= FM_model_num/100+48;     //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  °Ù
 225   1            strnum[2]= (FM_model_num%100)/10+48;//+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  Ê®
 226   1            strnum[3]= FM_model_num%10+48;      //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  ¸ö?
 227   1            dprintf(1,0,"Ö¸ÎÆ\xCA\xFD: ");//keilÀïÃæµÄbugÒªÓÃºº×ÖÄÚÂë´úÌæ¶ÔÓÚfdµÄºº×Ö,Ö¸ÎÆÊı
 228   1            dprintf(1,4,strnum);
 229   1            dprintf(1,6,"    ");//Ò»ĞĞÄÚ²¹¿Õ¸ñ±ÜÃâÁËÏÔÊ¾ÂÒÂë
 230   1            dprintf(2,0,"µÚÒ»´ÎÂ¼Èë      ");
 231   1            dprintf(3,0,"µÈ\xB4\xFDÖĞ..........");//µÈ´ıÖĞ......
 232   1            if(FM_GetImage()==1){//»ñÈ¡Ö¸ÎÆÍ¼Ïñ
 233   2              dprintf(1,0,"µÚÒ»´Î»ñÈ¡³É¹¦  ");
 234   2              dprintf(2,0,"                ");
 235   2              dprintf(3,0,"\xD5\xFDÔÚ±£´æµ½¼Ä´æÆ÷");
 236   2              if(FM_CreatChar_buffer(1)==1){//±£´æµ½¼Ä´æÆ÷1
 237   3                if(FM_Searchfinger1()==0xff){//ÓÃbuffer1ËÑË÷Ö¸ÎÆÈç¹ûÃ»ÓĞÊÕµ½ÄÇ¾ÍÊÇ¸ÃÖ¸ÎÆ»¹Ã»Â¼Èë
 238   4                  goto con_tinue;//¼ÌĞøÕı³£µÄ³ÌĞòÁ÷
 239   4                }else{
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 5   

 240   4                  dprintf(1,0,"¸ÃÖ¸ÎÆÒÑ¾­´æÔÚ  ");
 241   4                  dprintf(2,0,"                ");
 242   4                  dprintf(3,0,"ÈÎÒâ¼üÍË»ØÖØÊÔ  ");
 243   4                  buzzer=0;
 244   4                  delayms(500);//·äÃù
 245   4                  buzzer=1;
 246   4                  goto end;
 247   4                }
 248   3                con_tinue:
 249   3                dprintf(1,0,"±£´æ³É¹¦        ");
 250   3                dprintf(2,0,"                ");
 251   3                dprintf(3,0,"                ");
 252   3                buzzer=0;
 253   3                delayms(500);//·äÃùÆ÷100ms
 254   3                buzzer=1;
 255   3                delayms(1000);//ÈÃ×ÖÄ»ÏÔÊ¾2Ãë
 256   3                dprintf(3,0,"¿ªÊ¼µÚ¶ş´ÎÂ¼Èë  ");
 257   3                if(FM_GetImage()==1){//»ñÈ¡Ö¸ÎÆÍ¼Ïñ
 258   4                  dprintf(1,0,"µÚ¶ş´Î»ñÈ¡³É¹¦  ");
 259   4                  dprintf(2,0,"                ");
 260   4                  dprintf(3,0,"\xD5\xFDÔÚ±£´æµ½¼Ä´æÆ÷");
 261   4                  if(FM_CreatChar_buffer(2)==1){//½«Í¼Ïñ±£´æµ½¼Ä´æÆ÷2
 262   5                    dprintf(1,0,"±£´æ³É¹¦        ");
 263   5                    dprintf(2,0,"                ");
 264   5                    dprintf(3,0,"                ");
 265   5                    buzzer=0;
 266   5                    delayms(500);//·äÃùÆ÷100ms
 267   5                    buzzer=1;
 268   5                    delayms(1000);//ÈÃ×ÖÄ»ÏÔÊ¾2Ãë
 269   5                    dprintf(3,0,"¿ªÊ¼Éú³ÉÄ£°æ    ");
 270   5                    if(FM_RegModel_Charbuffer()==1){//¸ù¾İÂ¼ÈëµÄÁ½¸öÖ¸ÎÆÌØÕ÷ÂëÉú³ÉÄ£°æ
 271   6                      dprintf(1,0,"Éú³ÉÄ£°æ³É¹¦    ");
 272   6                      dprintf(2,0,"                ");
 273   6                      dprintf(3,0,"ÕıÔÚ±£´æÄ£°æ    ");
 274   6                      FM_model_num=FM_model_num+1;//ÓÃµ±Ç°ÓĞĞ§Ö¸ÎÆÊı¼Ó1
 275   6                      //Êı×Ö×ªÎªcharÀàĞÍÏÔÊ¾
 276   6                      strnum[0]=32;//acsiiÂë¿Õ¸ñ
 277   6                      strnum[1]= FM_model_num/100+48;     //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  °Ù
 278   6                      strnum[2]= (FM_model_num%100)/10+48;//+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  Ê®
 279   6                      strnum[3]= FM_model_num%10+48;      //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  ¸ö?
 280   6                      if(FM_Save_model(FM_model_num)==1){//±£´æÄ£°æ³É¹¦£¬¸ù¾İÂ¼ÈëµÄÁ½¸öÖ¸ÎÆÌØÕ÷ÂëÉú³ÉÄ£°æ£¬±£´æµ½FM_mode
             -l_num+1ÖĞ
 281   7                        //dprintf(0,0,"    ×î¸ßÈ¨ÏŞ    ");
 282   7                        dprintf(1,0,"  ±£´æÖ¸ÎÆ³É¹¦  ");
 283   7                        dprintf(2,0,"Ö¸ÎÆºÅ:");
 284   7                        dprintf(2,4,strnum);
 285   7                        dprintf(2,6,"    ");//Ò»ĞĞÄÚ²¹¿Õ¸ñ±ÜÃâÁËÏÔÊ¾ÂÒÂë
 286   7                        dprintf(3,0,"°´ÈÎÒâ¼ü·µ»Ø    ");
 287   7                        goto end;
 288   7                      }else{//±£´æÄ£°æÊ§°Ü
 289   7                        dprintf(1,0,"±£´æÖ¸ÎÆÊ§°Ü    ");
 290   7                        dprintf(2,0,"                ");
 291   7                        dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 292   7                        goto end;
 293   7                      }
 294   6                    }else{
 295   6                      dprintf(1,0,"Éú³ÉÖ¸ÎÆÄ£°æÊ§°Ü");
 296   6                      dprintf(2,0,"                ");
 297   6                      dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 298   6                      goto end;
 299   6                    }
 300   5                  }else{
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 6   

 301   5                    dprintf(1,0,"±£´æ¼Ä´æÆ÷¶şÊ§°Ü");
 302   5                    dprintf(2,0,"                ");
 303   5                    dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 304   5                    goto end;
 305   5                  }
 306   4                }else{
 307   4                  dprintf(1,0,"»ñÈ¡Ö¸ÎÆ¶şÊ§°Ü  ");
 308   4                  dprintf(2,0,"                ");
 309   4                  dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 310   4                  goto end;
 311   4                }
 312   3              }else
 313   2              {
 314   3                dprintf(1,0,"±£´æ¼Ä´æÆ÷Ò»Ê§°Ü");
 315   3                dprintf(2,0,"                ");
 316   3                dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 317   3                goto end;
 318   3              }
 319   2            }else{//»ñÈ¡Ö¸ÎÆÊ§°Ü
 320   2              dprintf(1,0,"»ñÈ¡Ö¸ÎÆÒ»Ê§°Ü  ");
 321   2              dprintf(2,0,"                ");
 322   2              dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 323   2              goto end;
 324   2            }
 325   1            //----------------¶ÁÈ¡Á½´ÎÖ¸ÎÆ²¢Éú³ÉÄ£°æ£¬±£´æÄ£°æ½áÊø-------------------------
 326   1        end:  
 327   1        ET0=1;//¿ªÉ¨Ãè
 328   1      }
 329          
 330          void Stat22(void){//Çå¿ÕÖ¸ÎÆ--È·¶¨
 331   1        unsigned char search_num=0;
 332   1        //unsigned int time_count=0;
 333   1        ET0=0;
 334   1        LcmClearTXT();//Çå³ıÎÄ±¾
 335   1        LcmClearBMP();//Çå³ıÍ¼Ïñ
 336   1        dprintf(0,0,"×¢Òâ¸Ã²Ù×÷»áÉ¾\xB3\xFD");
 337   1        dprintf(1,0,"ËùÓĞÖ¸ÎÆ°üÀ¨¹ÜÀí");
 338   1        dprintf(2,0,"Ô±Ö¸ÎÆ!!        ");
 339   1        dprintf(3,0,"È·¶¨¼ÌĞøÍË³öÈ¡Ïû");
 340   1        while(1){//µÈ´ıÓÃ»§°´¼üÑ¡Ôñ¼ÌĞø»¹ÊÇÍË³,ö
 341   2          keyscan();//°´¼üÉ¨Ãè
 342   2          switch(Trg){
 343   3            case  G_cankey:       //°´ÏÂÈ¡Ïû¼ü,P3.4
 344   3            {
 345   4              goto end;//ÍË³ö
 346   4            }
 347   3            case G_entkey://°´ÏÂÈ·¶¨¼üÅÌ
 348   3            {
 349   4      
 350   4              goto begin;
 351   4            }
 352   3            default:break;
 353   3          }
 354   2          //time_count++;
 355   2        }
 356   1        goto end;//Èç¹ûÊÇwhileÒòÎª³¬Ê±ÍË³öµÄÏÂÃæµÄÑéÖ¤¾Í²»ÔËĞĞÁË
 357   1        begin://Èç¹ûÓÃ»§°´ÏÂÈ·¶¨¼üÅÌ
 358   1        dprintf(0,0,"É¾\xB3\xFDËùÓĞÖ¸ÎÆ    ");
 359   1        dprintf(1,0,"Çë¹ÜÀíÔ±ÊäÈëÖ¸ÎÆ");
 360   1        dprintf(2,0,"                ");
 361   1        dprintf(3,0,"µÈ\xB4\xFDÊäÈë........");
 362   1        search_num=FM_Search();
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 7   

 363   1        buzzer=0;
 364   1        delayms(300);
 365   1        buzzer=1;
 366   1        if(search_num==1||search_num==2){//ÄãÊÇ¹ÜÀíÔ±
 367   2          if(FM_Empty()==1){//³É¹¦
 368   3              dprintf(0,0,"Çå¿ÕÖ¸ÎÆ¿â³É¹¦  ");
 369   3              dprintf(1,0,"                ");
 370   3              dprintf(2,0,"                ");
 371   3              dprintf(3,0,"°´ÈÎÒâ¼üÅÌ·µ»Ø  ");
 372   3              goto end;
 373   3          }else{
 374   3              dprintf(0,0,"Çå¿ÕÖ¸ÎÆ¿âÊ§°Ü  ");
 375   3              dprintf(1,0,"                ");
 376   3              dprintf(2,0,"                ");
 377   3              dprintf(3,0,"°´ÈÎÒâ¼üÅÌ·µ»Ø  ");
 378   3              goto end;
 379   3          }
 380   2        }else if(search_num=0xff){//ÄãµÄÖ¸ÎÆÊäÈëÓĞ´í£¬²»´æÔÚ
*** WARNING C276 IN LINE 380 OF src\main.c: constant in condition expression
 381   2          dprintf(0,0,"ÄãµÄÖ¸ÎÆ²»´æÔÚ  ");
 382   2          dprintf(1,0,"                ");
 383   2          dprintf(2,0,"                ");
 384   2          dprintf(3,0,"°´ÈÎÒâ¼ü·µ»Ø    ");
 385   2          goto end;
 386   2        }else{//ÆäËû²»¾ßÓĞ¹ÜÀíÔ±È¨ÏŞµÄÖ¸ÎÆ
 387   2          dprintf(0,0,"ÄãµÄÖ¸ÎÆÈ¨ÏŞ²»¹»");
 388   2          dprintf(1,0,"½ö¹ÜÀíÔ±¿ÉÒÔ²Ù×÷");
 389   2          dprintf(2,0,"                ");
 390   2          dprintf(3,0,"°´ÈÎÒâ¼ü·µ»Ø    ");
 391   2          goto end;
 392   2        }
 393   1        
 394   1        end:
 395   1        ET0=1;
 396   1      }
 397          
 398          /*
 399          void Stat23(void){//Çå¿ÕÖ¸ÎÆ--È·¶
 400            unsigned char num;
 401            unsigned char strnum[4]={0};//ÊıÁ¿×ª»»Îª×Ö·û´®
 402            ET0=0;
 403            LcmClearBMP();//Çå³ıÍ¼Ïñ
 404            num=FM_Search();
 405                          strnum[0]=32;//acsiiÂë¿Õ¸ñ
 406                          strnum[1]= num/100+48;     //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  °Ù
 407                          strnum[2]= (num%100)/10+48;//+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  Ê®
 408                          strnum[3]= num%10+48;      //+48ÊÇÎªÁË×ª»»ÔÚASCIIÂë  ¸ö?
 409            if(num==0xff){//Ê§°Ü
 410                  dprintf(0,0,"Çå¿ÕÖ¸ÎÆÊ§°Ü    ");
 411                  dprintf(1,0,"                ");
 412                  dprintf(2,0,"                ");
 413                  dprintf(3,0,"ÇëÍË»Ø          ");
 414            }else{//³É¹¦
 415                  dprintf(0,0,"Çå¿ÕÖ¸ÎÆ³É¹¦    ");
 416                  dprintf(1,0,"                ");
 417                  dprintf(2,0,strnum);
 418                  dprintf(2,4,"            ");
 419                  dprintf(3,0,"ÇëÍË»ØÖØÊÔ      ");
 420            }
 421            ET0=1;
 422          }
 423          */
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 8   

 424          /*-------------------------------------------------------------*/
 425           //Êı¾İ½á¹¹Êı×é,Êı×Ö´ú±íÃ¿¸ö°´¼ü°´ÏÂÊÇµÄ½øÈëµÄ×´Ì¬
 426          StateTab code KeyTab[12]=
 427          {
 428            {0,1,1,1,1,   (*Stat00)}, //ÎÕÊÖ¼ì²â£¬okµÄ»°¿ÉÒÔÏÔÊ¾ÏÂ¸ö×´Ì¬²»ĞĞµÄ»°¾Í¹Ø¼üÅÌÖĞ¶ÏÉ¨Ãè
 429            {1,1,2,4,1,   (*Stat10)},    //¶¥²ã£¬´ò¿ª¿ª¹Ø  µ±Ç°µÄ×´Ì¬Ë÷ÒıºÅ,°´ÏÂÏòÏÂ¼üÊ±µÄ×´Ì¬Ë÷ÒıºÅ,°´ÏÂÏòÉÏ¼üÊ±µÄ×´
             -Ì¬Ë÷ÒıºÅ,°´ÏÂ»Ø³µ¼üÊ±µÄ×´Ì¬Ë÷ÒıºÅ,µ±Ç°×´Ì¬Ó¦¸ÃÖ´ĞĞµÄ¹¦ÄÜ²Ù×÷
 430            {2,1,3,5,2,   (*Stat11)},    //¶¥²ã£¬Â¼ÈëÖ¸ÎÆ
 431            {3,2,3,6,3,   (*Stat12)},    //¶¥²ã£¬Çå¿ÕÖ¸ÎÆ
 432            //{4,3,4,8,4,   (*Stat13)},    //¶¥²ã£¬²âÊÔ
 433            
 434            {4,1,1,1,1,   (*Stat20)},//µÚ¶ş²ã£¬´ò¿ª¿ª¹ØµÄ×Ó²Ëµ¥
 435            {5,2,2,2,2,   (*Stat21)},//µÚ¶ş²ã,Â¼ÈëÖ¸ÎÆ
 436            {6,3,3,3,3,   (*Stat22)},//µÚ¶ş²ã Çå¿ÕÖ¸ÎÆ
 437            //{8,2,2,2,2,   (*Stat23)},//µÚ¶ş²ã Çå¿ÕÖ¸ÎÆ  
 438          };
 439          
 440          //==================================================================================
 441          //========×´Ì¬»ú½á¹¹½áÊø======================================
 442          //=================================================
 443          
 444          //**************?????***************************
 445           void delayms(int ms) 
 446          {      
 447   1       unsigned char j;
 448   1       while(ms--)
 449   1       {
 450   2          for(j =0;j<120;j++);
 451   2       }
 452   1      }
 453          //=======°´¼üÉ¨Ãè=============
 454          void keyscan(){//·µ»ØÊÇÄÄ¸ö°´¼ü
 455   1        unsigned char ReadDate=KEY^0xff;;
 456   1        Trg=ReadDate&(ReadDate^Cont);
 457   1        Cont=ReadDate;
 458   1      }
 459          /*-------------------------------------------------------------*/
 460          void MenuOperate() interrupt 1
 461          {
 462   1         keyscan(); //¼üÅÌÉ¨Ãè£¬¸Ä²»ÁËTrg£¬ContµÄÖµ
 463   1          switch(Trg) //¼ì²â°´¼ü´¥·¢
 464   1        {
 465   2            case  G_upkey:           //ÏòÉÏµÄ¼ü£¬TrgÎª1000 0000 ´ú±íP3.7´¥·¢ÁËÒ»´Î
 466   2          {
 467   3              KeyFuncIndex=KeyTab[KeyFuncIndex].KeyUpState;
 468   3              //ÏÂÃæÊÇÖ´ĞĞ°´¼üµÄ²Ù×÷
 469   3              KeyFuncPtr=KeyTab[KeyFuncIndex].CurrentOperate;
 470   3              (*KeyFuncPtr)();     //Ö´ĞĞµ±Ç°µÄ°´¼ü²Ù×÷
 471   3            buzzer=0;delayms(20);buzzer=1;//·äÃùÆ÷¶ÌÏìÆğ
 472   3            break; 
 473   3          }
 474   2          case  G_entkey:       //»Ø³µ¼ü,P3.5
 475   2          {
 476   3            KeyFuncIndex=KeyTab[KeyFuncIndex].KeyEnterState;
 477   3              //ÏÂÃæÊÇÖ´ĞĞ°´¼üµÄ²Ù×÷
 478   3            KeyFuncPtr=KeyTab[KeyFuncIndex].CurrentOperate;
 479   3            (*KeyFuncPtr)();     //Ö´ĞĞµ±Ç°µÄ°´¼ü²Ù×÷
 480   3            buzzer=0;delayms(20);buzzer=1;//·äÃùÆ÷¶ÌÏìÆğ
 481   3            break; 
 482   3          }
 483   2          case  G_downkey:        //ÏòÏÂµÄ¼ü,P3.6
 484   2          {
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 9   

 485   3            KeyFuncIndex=KeyTab[KeyFuncIndex].KeyDownState;
 486   3              //ÏÂÃæÊÇÖ´ĞĞ°´¼üµÄ²Ù×÷
 487   3            KeyFuncPtr=KeyTab[KeyFuncIndex].CurrentOperate;
 488   3            (*KeyFuncPtr)();     //Ö´ĞĞµ±Ç°µÄ°´¼ü²Ù×÷
 489   3            buzzer=0;delayms(20);buzzer=1;//·äÃùÆ÷¶ÌÏìÆğ
 490   3            break; 
 491   3          }
 492   2          case  G_cankey:       //°´ÏÂÈ¡Ïû¼ü,P3.4
 493   2          {
 494   3            KeyFuncIndex=KeyTab[KeyFuncIndex].KeyCancle;
 495   3              //ÏÂÃæÊÇÖ´ĞĞ°´¼üµÄ²Ù×÷
 496   3            KeyFuncPtr=KeyTab[KeyFuncIndex].CurrentOperate;
 497   3            (*KeyFuncPtr)();     //Ö´ĞĞµ±Ç°µÄ°´¼ü²Ù×÷
 498   3            buzzer=0;delayms(20);buzzer=1;//·äÃùÆ÷¶ÌÏìÆğ
 499   3            break; 
 500   3          }
 501   2          //´Ë´¦Ìí¼Ó°´¼ü´íÎó´úÂë,¶¨Ê±É¨ÃèÃ»ÓĞ¼ì²âµ½°´¼ü°´ÏÂ
 502   2          default:return;
 503   2        }
 504   1      } 
 505          void main(void){
 506   1        delayms(10);//µÈ´ıµ¥Æ¬»ú¸´Î»
 507   1        PSB=0;      //Òº¾§Îª´®¿ÚÏÔÊ¾Ä£Ê½£¬½«PSBÒı½ÅÉèÖÃÎª0
 508   1        
 509   1        //¿ª¶¨Ê±ÖĞ¶Ï-------------------------
 510   1        TMOD=0x01;//ÉèÖÃ¶¨Ê±Æ÷0Î»¹¤×÷Ä£Ê½1
 511   1        TH0=(65536-22936)/256;//×°³õÖµ11.0592Mhz¾§Õñ¶¨Ê±50msÊıÎª45872,25msÎª22936
 512   1        TL0=(65536-22936)%256;//
 513   1        EA=1;//¿ª×ÜÖĞ¶Ï
 514   1        ET0=1;//¿ª¶¨Ê±Æ÷0ÖĞ¶Ï
 515   1        TR0=1;//Æô¶¯¶¨Ê±Æ÷0
 516   1        //================================
 517   1        
 518   1        LcmInit(); //12864³õÊ¼»¯
 519   1        LcmClearTXT();//Çå³ıÎÄ±¾
 520   1        LcmClearBMP();//Çå³ıÍ¼Ïñ
 521   1        FM_Init();//³õÊ¼»¯Ö¸ÎÆÄ£¿éÖ÷ÒªÊÇ´®¿Ú
 522   1        //ÔËĞĞÒ»´Î½çÃæÏÔÊ¾
 523   1        KeyFuncPtr=KeyTab[KeyFuncIndex].CurrentOperate;
 524   1        (*KeyFuncPtr)();     //Ö´ĞĞµ±Ç°µÄ°´¼ü²Ù×÷£¬¾ÍÊÇstat00();
 525   1        
 526   1        while(1){
 527   2          //relay=1;
 528   2          //50ms¶¨Ê±ÖĞ¶Ï£¬É¨Ãè¼üÅÌÊäÈë,²»ÓÃ¶¨Ê±ÏìÓ¦»áºÜÂı
 529   2        }
 530   1      }
 531          
 532          
 533          //-------------------¸÷ÖÖ×Öº¯Êı-----------------------------
 534          
 535          
 536          
 537          
 538          
 539          
 540          
 541          
 542          
 543          
 544          
 545          
 546          
C51 COMPILER V9.51   MAIN                                                                  02/06/2015 11:31:59 PAGE 10  

 547          
 548          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2328    ----
   CONSTANT SIZE    =   1130    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
